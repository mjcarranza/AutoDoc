{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar _asyncToGenerator = require(\"C:/Users/mario/Desktop/AutoDocIA/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Impersonated = exports.IMPERSONATED_ACCOUNT_TYPE = void 0;\n\nconst oauth2client_1 = require(\"./oauth2client\");\n\nconst gaxios_1 = require(\"gaxios\");\n\nexports.IMPERSONATED_ACCOUNT_TYPE = 'impersonated_service_account';\n\nclass Impersonated extends oauth2client_1.OAuth2Client {\n  /**\n   * Impersonated service account credentials.\n   *\n   * Create a new access token by impersonating another service account.\n   *\n   * Impersonated Credentials allowing credentials issued to a user or\n   * service account to impersonate another. The source project using\n   * Impersonated Credentials must enable the \"IAMCredentials\" API.\n   * Also, the target service account must grant the orginating principal\n   * the \"Service Account Token Creator\" IAM role.\n   *\n   * @param {object} options - The configuration object.\n   * @param {object} [options.sourceClient] the source credential used as to\n   * acquire the impersonated credentials.\n   * @param {string} [options.targetPrincipal] the service account to\n   * impersonate.\n   * @param {string[]} [options.delegates] the chained list of delegates\n   * required to grant the final access_token. If set, the sequence of\n   * identities must have \"Service Account Token Creator\" capability granted to\n   * the preceding identity. For example, if set to [serviceAccountB,\n   * serviceAccountC], the sourceCredential must have the Token Creator role on\n   * serviceAccountB. serviceAccountB must have the Token Creator on\n   * serviceAccountC. Finally, C must have Token Creator on target_principal.\n   * If left unset, sourceCredential must have that role on targetPrincipal.\n   * @param {string[]} [options.targetScopes] scopes to request during the\n   * authorization grant.\n   * @param {number} [options.lifetime] number of seconds the delegated\n   * credential should be valid for up to 3600 seconds by default, or 43,200\n   * seconds by extending the token's lifetime, see:\n   * https://cloud.google.com/iam/docs/creating-short-lived-service-account-credentials#sa-credentials-oauth\n   * @param {string} [options.endpoint] api endpoint override.\n   */\n  constructor(options = {}) {\n    var _a, _b, _c, _d, _e, _f;\n\n    super(options); // Start with an expired refresh token, which will automatically be\n    // refreshed before the first API call is made.\n\n    this.credentials = {\n      expiry_date: 1,\n      refresh_token: 'impersonated-placeholder'\n    };\n    this.sourceClient = (_a = options.sourceClient) !== null && _a !== void 0 ? _a : new oauth2client_1.OAuth2Client();\n    this.targetPrincipal = (_b = options.targetPrincipal) !== null && _b !== void 0 ? _b : '';\n    this.delegates = (_c = options.delegates) !== null && _c !== void 0 ? _c : [];\n    this.targetScopes = (_d = options.targetScopes) !== null && _d !== void 0 ? _d : [];\n    this.lifetime = (_e = options.lifetime) !== null && _e !== void 0 ? _e : 3600;\n    this.endpoint = (_f = options.endpoint) !== null && _f !== void 0 ? _f : 'https://iamcredentials.googleapis.com';\n  }\n  /**\n   * Refreshes the access token.\n   * @param refreshToken Unused parameter\n   */\n\n\n  refreshToken(refreshToken) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c, _d, _e, _f;\n\n      try {\n        yield _this.sourceClient.getAccessToken();\n        const name = 'projects/-/serviceAccounts/' + _this.targetPrincipal;\n        const u = `${_this.endpoint}/v1/${name}:generateAccessToken`;\n        const body = {\n          delegates: _this.delegates,\n          scope: _this.targetScopes,\n          lifetime: _this.lifetime + 's'\n        };\n        const res = yield _this.sourceClient.request({\n          url: u,\n          data: body,\n          method: 'POST'\n        });\n        const tokenResponse = res.data;\n        _this.credentials.access_token = tokenResponse.accessToken;\n        _this.credentials.expiry_date = Date.parse(tokenResponse.expireTime);\n        return {\n          tokens: _this.credentials,\n          res\n        };\n      } catch (error) {\n        if (!(error instanceof Error)) throw error;\n        let status = 0;\n        let message = '';\n\n        if (error instanceof gaxios_1.GaxiosError) {\n          status = (_c = (_b = (_a = error === null || error === void 0 ? void 0 : error.response) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.error) === null || _c === void 0 ? void 0 : _c.status;\n          message = (_f = (_e = (_d = error === null || error === void 0 ? void 0 : error.response) === null || _d === void 0 ? void 0 : _d.data) === null || _e === void 0 ? void 0 : _e.error) === null || _f === void 0 ? void 0 : _f.message;\n        }\n\n        if (status && message) {\n          error.message = `${status}: unable to impersonate: ${message}`;\n          throw error;\n        } else {\n          error.message = `unable to impersonate: ${error}`;\n          throw error;\n        }\n      }\n    })();\n  }\n  /**\n   * Generates an OpenID Connect ID token for a service account.\n   *\n   * {@link https://cloud.google.com/iam/docs/reference/credentials/rest/v1/projects.serviceAccounts/generateIdToken Reference Documentation}\n   *\n   * @param targetAudience the audience for the fetched ID token.\n   * @param options the for the request\n   * @return an OpenID Connect ID token\n   */\n\n\n  fetchIdToken(targetAudience, options) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      yield _this2.sourceClient.getAccessToken();\n      const name = `projects/-/serviceAccounts/${_this2.targetPrincipal}`;\n      const u = `${_this2.endpoint}/v1/${name}:generateIdToken`;\n      const body = {\n        delegates: _this2.delegates,\n        audience: targetAudience,\n        includeEmail: (_a = options === null || options === void 0 ? void 0 : options.includeEmail) !== null && _a !== void 0 ? _a : true\n      };\n      const res = yield _this2.sourceClient.request({\n        url: u,\n        data: body,\n        method: 'POST'\n      });\n      return res.data.token;\n    })();\n  }\n\n}\n\nexports.Impersonated = Impersonated;","map":{"version":3,"names":["Object","defineProperty","exports","value","Impersonated","IMPERSONATED_ACCOUNT_TYPE","oauth2client_1","require","gaxios_1","OAuth2Client","constructor","options","_a","_b","_c","_d","_e","_f","credentials","expiry_date","refresh_token","sourceClient","targetPrincipal","delegates","targetScopes","lifetime","endpoint","refreshToken","getAccessToken","name","u","body","scope","res","request","url","data","method","tokenResponse","access_token","accessToken","Date","parse","expireTime","tokens","error","Error","status","message","GaxiosError","response","fetchIdToken","targetAudience","audience","includeEmail","token"],"sources":["C:/Users/mario/Desktop/AutoDocIA/node_modules/google-auth-library/build/src/auth/impersonated.js"],"sourcesContent":["\"use strict\";\n/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Impersonated = exports.IMPERSONATED_ACCOUNT_TYPE = void 0;\nconst oauth2client_1 = require(\"./oauth2client\");\nconst gaxios_1 = require(\"gaxios\");\nexports.IMPERSONATED_ACCOUNT_TYPE = 'impersonated_service_account';\nclass Impersonated extends oauth2client_1.OAuth2Client {\n    /**\n     * Impersonated service account credentials.\n     *\n     * Create a new access token by impersonating another service account.\n     *\n     * Impersonated Credentials allowing credentials issued to a user or\n     * service account to impersonate another. The source project using\n     * Impersonated Credentials must enable the \"IAMCredentials\" API.\n     * Also, the target service account must grant the orginating principal\n     * the \"Service Account Token Creator\" IAM role.\n     *\n     * @param {object} options - The configuration object.\n     * @param {object} [options.sourceClient] the source credential used as to\n     * acquire the impersonated credentials.\n     * @param {string} [options.targetPrincipal] the service account to\n     * impersonate.\n     * @param {string[]} [options.delegates] the chained list of delegates\n     * required to grant the final access_token. If set, the sequence of\n     * identities must have \"Service Account Token Creator\" capability granted to\n     * the preceding identity. For example, if set to [serviceAccountB,\n     * serviceAccountC], the sourceCredential must have the Token Creator role on\n     * serviceAccountB. serviceAccountB must have the Token Creator on\n     * serviceAccountC. Finally, C must have Token Creator on target_principal.\n     * If left unset, sourceCredential must have that role on targetPrincipal.\n     * @param {string[]} [options.targetScopes] scopes to request during the\n     * authorization grant.\n     * @param {number} [options.lifetime] number of seconds the delegated\n     * credential should be valid for up to 3600 seconds by default, or 43,200\n     * seconds by extending the token's lifetime, see:\n     * https://cloud.google.com/iam/docs/creating-short-lived-service-account-credentials#sa-credentials-oauth\n     * @param {string} [options.endpoint] api endpoint override.\n     */\n    constructor(options = {}) {\n        var _a, _b, _c, _d, _e, _f;\n        super(options);\n        // Start with an expired refresh token, which will automatically be\n        // refreshed before the first API call is made.\n        this.credentials = {\n            expiry_date: 1,\n            refresh_token: 'impersonated-placeholder',\n        };\n        this.sourceClient = (_a = options.sourceClient) !== null && _a !== void 0 ? _a : new oauth2client_1.OAuth2Client();\n        this.targetPrincipal = (_b = options.targetPrincipal) !== null && _b !== void 0 ? _b : '';\n        this.delegates = (_c = options.delegates) !== null && _c !== void 0 ? _c : [];\n        this.targetScopes = (_d = options.targetScopes) !== null && _d !== void 0 ? _d : [];\n        this.lifetime = (_e = options.lifetime) !== null && _e !== void 0 ? _e : 3600;\n        this.endpoint = (_f = options.endpoint) !== null && _f !== void 0 ? _f : 'https://iamcredentials.googleapis.com';\n    }\n    /**\n     * Refreshes the access token.\n     * @param refreshToken Unused parameter\n     */\n    async refreshToken(refreshToken) {\n        var _a, _b, _c, _d, _e, _f;\n        try {\n            await this.sourceClient.getAccessToken();\n            const name = 'projects/-/serviceAccounts/' + this.targetPrincipal;\n            const u = `${this.endpoint}/v1/${name}:generateAccessToken`;\n            const body = {\n                delegates: this.delegates,\n                scope: this.targetScopes,\n                lifetime: this.lifetime + 's',\n            };\n            const res = await this.sourceClient.request({\n                url: u,\n                data: body,\n                method: 'POST',\n            });\n            const tokenResponse = res.data;\n            this.credentials.access_token = tokenResponse.accessToken;\n            this.credentials.expiry_date = Date.parse(tokenResponse.expireTime);\n            return {\n                tokens: this.credentials,\n                res,\n            };\n        }\n        catch (error) {\n            if (!(error instanceof Error))\n                throw error;\n            let status = 0;\n            let message = '';\n            if (error instanceof gaxios_1.GaxiosError) {\n                status = (_c = (_b = (_a = error === null || error === void 0 ? void 0 : error.response) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.error) === null || _c === void 0 ? void 0 : _c.status;\n                message = (_f = (_e = (_d = error === null || error === void 0 ? void 0 : error.response) === null || _d === void 0 ? void 0 : _d.data) === null || _e === void 0 ? void 0 : _e.error) === null || _f === void 0 ? void 0 : _f.message;\n            }\n            if (status && message) {\n                error.message = `${status}: unable to impersonate: ${message}`;\n                throw error;\n            }\n            else {\n                error.message = `unable to impersonate: ${error}`;\n                throw error;\n            }\n        }\n    }\n    /**\n     * Generates an OpenID Connect ID token for a service account.\n     *\n     * {@link https://cloud.google.com/iam/docs/reference/credentials/rest/v1/projects.serviceAccounts/generateIdToken Reference Documentation}\n     *\n     * @param targetAudience the audience for the fetched ID token.\n     * @param options the for the request\n     * @return an OpenID Connect ID token\n     */\n    async fetchIdToken(targetAudience, options) {\n        var _a;\n        await this.sourceClient.getAccessToken();\n        const name = `projects/-/serviceAccounts/${this.targetPrincipal}`;\n        const u = `${this.endpoint}/v1/${name}:generateIdToken`;\n        const body = {\n            delegates: this.delegates,\n            audience: targetAudience,\n            includeEmail: (_a = options === null || options === void 0 ? void 0 : options.includeEmail) !== null && _a !== void 0 ? _a : true,\n        };\n        const res = await this.sourceClient.request({\n            url: u,\n            data: body,\n            method: 'POST',\n        });\n        return res.data.token;\n    }\n}\nexports.Impersonated = Impersonated;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}